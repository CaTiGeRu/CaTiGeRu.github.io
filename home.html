<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- 首要添加UTF-8编码声明，放在head最前面 -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>大柯のblog</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 新增：Markdown解析库 (marked.js) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- 新增：LaTeX渲染库 (KaTeX) + 样式 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            orange: {
              light: '#FFE0B2',
              DEFAULT: '#FF9800',
              dark: '#E65100',
            },
            neutral: {
              100: '#F5F5F5',
              200: '#EEEEEE',
              300: '#E0E0E0',
              600: '#757575',
              700: '#616161',
              800: '#424242',
              900: '#212121',
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      .slide-up {
        animation: slideUp 0.5s ease-out;
      }
      .slide-down {
        animation: slideDown 0.3s ease-in-out;
      }
      .scale-in {
        animation: scaleIn 0.3s ease-in-out;
      }
    }
  </style>
  
  <style>
    /* 导入Inter字体 */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    /* 平滑滚动 */
    html {
      scroll-behavior: smooth;
    }
    
    /* 渐变背景动画 */
    .gradient-bg {
      background: linear-gradient(135deg, #FF9800 0%, #E65100 100%);
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    /* 编辑器样式 */
    .editor-toolbar button {
      transition: all 0.2s ease;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .editor-toolbar button:hover {
      background-color: #FFE0B2;
      transform: scale(1.1);
    }
    
    .editor-content:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(255, 152, 0, 0.3);
    }
    
    /* Markdown编辑器内容区样式 */
    .editor-content {
      white-space: pre-wrap;
      line-height: 1.6;
    }
    
    /* Markdown渲染样式（文章展示用） */
    .markdown-render h1 {
      font-size: 2rem;
      font-weight: 700;
      margin: 1.5rem 0 1rem;
      color: #212121;
    }
    
    .markdown-render h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 1.2rem 0 0.8rem;
      color: #212121;
    }
    
    .markdown-render p {
      margin: 0.8rem 0;
      line-height: 1.8;
    }
    
    .markdown-render ul, .markdown-render ol {
      margin: 0.8rem 0 0.8rem 1.5rem;
      line-height: 1.8;
    }
    
    .markdown-render blockquote {
      border-left: 4px solid #FF9800;
      padding: 0.5rem 1rem;
      margin: 1rem 0;
      background-color: #FFF8E1;
      border-radius: 0 4px 4px 0;
    }
    
    .markdown-render code {
      background-color: #F5F5F5;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: 'Consolas', monospace;
      font-size: 0.9rem;
    }
    
    .markdown-render pre {
      background-color: #F5F5F5;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      margin: 1rem 0;
    }
    
    .markdown-render pre code {
      padding: 0;
      background: transparent;
    }
    
    .markdown-render a {
      color: #FF9800;
      text-decoration: underline;
      transition: color 0.2s;
    }
    
    .markdown-render a:hover {
      color: #E65100;
    }
    
    .markdown-render img {
      max-width: 100%;
      border-radius: 4px;
      margin: 1rem 0;
    }
    
    /* 管理表格样式 */
    .manage-table tr {
      transition: background-color 0.2s ease;
    }
    
    .manage-table tr:hover {
      background-color: rgba(255, 224, 178, 0.3);
    }
    
    /* 排序按钮样式 */
    .sort-btn.active {
      background-color: #FF9800;
      color: white;
    }
    
    .sort-btn.active .sort-icon {
      transform: rotate(180deg);
    }
  </style>
</head>

<body class="bg-neutral-100 font-sans text-neutral-800">
  <!-- 导航栏 -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-sm shadow-sm transition-all duration-300">
    <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="#" class="text-xl font-bold text-orange-dark flex items-center gap-2">
        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
        <span>大柯のblog</span>
      </a>
      
      <!-- 桌面导航 -->
      <div class="hidden md:flex items-center gap-6">
        <a href="#" class="font-medium hover:text-orange transition-colors" data-page="home">首页</a>
        <a href="#" class="font-medium hover:text-orange transition-colors" data-page="categories">分类</a>
        <a href="#" class="font-medium hover:text-orange transition-colors" data-page="manage">管理文章</a>
        <a href="#" class="font-medium hover:text-orange transition-colors" data-page="about">关于</a>
        <a href="#" class="font-medium hover:text-orange transition-colors" data-page="write">
          <i class="fa fa-plus-circle mr-1" aria-hidden="true"></i> 写文章
        </a>
        <button class="bg-orange hover:bg-orange-dark text-white px-4 py-2 rounded-full transition-colors">
          <i class="fa fa-search mr-1" aria-hidden="true"></i> 搜索
        </button>
      </div>
      
      <!-- 移动端菜单按钮 -->
      <button class="md:hidden text-neutral-800 hover:text-orange transition-colors" id="menuBtn">
        <i class="fa fa-bars text-xl" aria-hidden="true"></i>
      </button>
    </nav>
    
    <!-- 移动端导航菜单 -->
    <div class="md:hidden hidden bg-white border-t" id="mobileMenu">
      <div class="container mx-auto px-4 py-3 flex flex-col gap-3">
        <a href="#" class="py-2 font-medium hover:text-orange transition-colors" data-page="home">首页</a>
        <a href="#" class="py-2 font-medium hover:text-orange transition-colors" data-page="categories">分类</a>
        <a href="#" class="py-2 font-medium hover:text-orange transition-colors" data-page="manage">管理文章</a>
        <a href="#" class="py-2 font-medium hover:text-orange transition-colors" data-page="about">关于</a>
        <a href="#" class="py-2 font-medium hover:text-orange transition-colors" data-page="write">
          <i class="fa fa-plus-circle mr-1" aria-hidden="true"></i> 写文章
        </a>
        <div class="relative">
          <input type="text" placeholder="搜索文章..." class="w-full px-4 py-2 rounded-full border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-orange/50">
          <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-600">
            <i class="fa fa-search" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- 页面容器 - 所有页面内容都在这里切换显示 -->
    <div id="pageContainer">
      <!-- 首页内容 -->
      <div id="homePage" class="page-content">
        <!-- 博客标题区域 -->
        <section class="gradient-bg text-white py-16 md:py-24">
          <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 text-shadow">大柯のblog</h1>
            <p class="text-lg md:text-xl max-w-2xl mx-auto opacity-90">关注大柯喵，关注大柯谢谢喵。</p>
          </div>
        </section>
        
        <!-- 文章列表区域 -->
        <section class="container mx-auto px-4 py-12">
          <div class="flex justify-between items-center mb-8 flex-wrap gap-4">
            <h2 class="text-2xl font-bold text-neutral-800">最新文章</h2>
            <div class="flex gap-2">
              <button class="px-3 py-1 rounded-full bg-orange text-white text-sm category-filter" data-category="all">全部</button>
              <button class="px-3 py-1 rounded-full bg-white border border-neutral-300 hover:border-orange hover:text-orange text-sm transition-colors category-filter" data-category="技术">技术</button>
              <button class="px-3 py-1 rounded-full bg-white border border-neutral-300 hover:border-orange hover:text-orange text-sm transition-colors category-filter" data-category="生活">生活</button>
              <button class="px-3 py-1 rounded-full bg-white border border-neutral-300 hover:border-orange hover:text-orange text-sm transition-colors category-filter" data-category="思考">思考</button>
            </div>
          </div>
          
          <!-- 文章网格 -->
          <div id="articlesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- 文章将通过JavaScript动态加载 -->
            <div id="noArticles" class="col-span-full text-center py-16 hidden">
              <i class="fa fa-file-text-o text-6xl text-neutral-300 mb-4" aria-hidden="true"></i>
              <p class="text-neutral-600 text-lg">还没有发布任何文章</p>
              <a href="#" class="inline-block mt-4 text-orange hover:underline font-medium" data-page="write">
                <i class="fa fa-pencil mr-1" aria-hidden="true"></i> 写第一篇文章
              </a>
            </div>
          </div>
          
          <!-- 加载更多按钮 -->
          <div class="mt-12 text-center">
            <button id="loadMoreBtn" class="px-6 py-3 bg-white border-2 border-orange text-orange rounded-full font-medium hover:bg-orange hover:text-white transition-colors duration-300 hidden">
              加载更多文章 <i class="fa fa-refresh ml-2" aria-hidden="true"></i>
            </button>
          </div>
        </section>
        
        <!-- 订阅区域 -->
        <section class="bg-orange-light py-12 mt-12">
          <div class="container mx-auto px-4 text-center">
            <h2 class="text-2xl font-bold mb-3">订阅我的博客更新</h2>
            <p class="text-neutral-700 mb-6 max-w-md mx-auto">第一时间获取最新垃圾信息~</p>
            <div class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
              <input type="email" placeholder="输入你的邮箱地址" class="flex-1 px-4 py-3 rounded-full focus:outline-none focus:ring-2 focus:ring-orange">
              <button class="bg-orange hover:bg-orange-dark text-white px-6 py-3 rounded-full font-medium transition-colors">
                订阅 <i class="fa fa-paper-plane ml-1" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </section>
      </div>
      
      <!-- 写文章页面 -->
      <div id="writePage" class="page-content hidden py-12">
        <div class="container mx-auto px-4 max-w-4xl">
          <div class="flex items-center mb-8">
            <a href="#" class="text-neutral-600 hover:text-orange mr-4 transition-colors" data-page="home">
              <i class="fa fa-arrow-left" aria-hidden="true"></i> 返回首页
            </a>
            <h2 class="text-2xl font-bold">写文章</h2>
            <!-- 新增：语法提示 -->
            <div class="ml-auto text-sm text-neutral-500">
              <i class="fa fa-info-circle mr-1"></i> 支持Markdown和LaTeX（$公式$ 或 $$块级公式$$）
            </div>
          </div>
          
          <form id="articleForm" class="bg-white rounded-xl shadow-md p-6 md:p-8">
            <input type="hidden" id="articleId"> <!-- 用于编辑现有文章 -->
            
            <div class="mb-6">
              <label for="articleTitle" class="block text-neutral-700 font-medium mb-2">标题</label>
              <input type="text" id="articleTitle" name="title" 
                     class="w-full px-4 py-3 rounded-lg border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-orange focus:border-transparent"
                     placeholder="输入文章标题..." required>
            </div>
            
            <div class="mb-6">
              <label for="articleCategory" class="block text-neutral-700 font-medium mb-2">分类</label>
              <select id="articleCategory" name="category" 
                      class="w-full px-4 py-3 rounded-lg border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-orange focus:border-transparent"
                      required>
                <option value="">选择分类</option>
                <option value="技术">技术</option>
                <option value="生活">生活</option>
                <option value="思考">思考</option>
                <option value="旅行">旅行</option>
                <option value="阅读">阅读</option>
              </select>
            </div>
            
            <div class="mb-6">
              <label for="articleCover" class="block text-neutral-700 font-medium mb-2">封面图URL</label>
              <input type="url" id="articleCover" name="cover" 
                     class="w-full px-4 py-3 rounded-lg border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-orange focus:border-transparent"
                     placeholder="输入图片URL...">
              <p class="text-sm text-neutral-500 mt-1"></p>
            </div>
            
            <div class="mb-6">
              <label class="block text-neutral-700 font-medium mb-2">内容编辑（支持Markdown/LaTeX）</label>
              
              <!-- 新增：Markdown+LaTeX工具栏 -->
              <div class="editor-toolbar flex flex-wrap gap-2 p-3 bg-neutral-100 rounded-t-lg border border-b-0 border-neutral-300">
                <!-- 标题 -->
                <button type="button" data-action="h1" title="一级标题 (# 标题)">
                  <i class="fa fa-header" aria-hidden="true"></i> 1
                </button>
                <button type="button" data-action="h2" title="二级标题 (## 标题)">
                  <i class="fa fa-header" aria-hidden="true"></i> 2
                </button>
                <!-- 文本格式 -->
                <button type="button" data-action="bold" title="粗体 (**文本**)">
                  <i class="fa fa-bold" aria-hidden="true"></i>
                </button>
                <button type="button" data-action="italic" title="斜体 (*文本*)">
                  <i class="fa fa-italic" aria-hidden="true"></i>
                </button>
                <button type="button" data-action="strike" title="删除线 (~~文本~~)">
                  <i class="fa fa-strikethrough" aria-hidden="true"></i>
                </button>
                <!-- 列表 -->
                <button type="button" data-action="ul" title="无序列表 (- 项)">
                  <i class="fa fa-list-ul" aria-hidden="true"></i>
                </button>
                <button type="button" data-action="ol" title="有序列表 (1. 项)">
                  <i class="fa fa-list-ol" aria-hidden="true"></i>
                </button>
                <!-- 引用/代码 -->
                <button type="button" data-action="quote" title="引用 (> 内容)">
                  <i class="fa fa-quote-left" aria-hidden="true"></i>
                </button>
                <button type="button" data-action="code" title="代码块 (```)">
                  <i class="fa fa-code" aria-hidden="true"></i>
                </button>
                <!-- 链接/图片 -->
                <button type="button" data-action="link" title="链接 ([文本](url))">
                  <i class="fa fa-link" aria-hidden="true"></i>
                </button>
                <button type="button" data-action="image" title="图片 (![alt](url))">
                  <i class="fa fa-image" aria-hidden="true"></i>
                </button>
                <!-- LaTeX公式 -->
                <button type="button" data-action="latex-inline" title="内联公式 ($公式$)">
                  <i class="fa fa-square-root-o" aria-hidden="true"></i> 内联
                </button>
                <button type="button" data-action="latex-block" title="块级公式 ($$公式$$)">
                  <i class="fa fa-square-root-o" aria-hidden="true"></i> 块级
                </button>
                <!-- 清除格式 -->
                <button type="button" data-action="clear" title="清除格式">
                  <i class="fa fa-eraser" aria-hidden="true"></i>
                </button>
              </div>
              
              <!-- 编辑器内容区（存储Markdown文本） -->
              <div id="articleContent" class="editor-content w-full min-h-[300px] px-4 py-3 rounded-b-lg border border-neutral-300 focus:outline-none"
                   contenteditable="true" placeholder="输入Markdown内容，支持LaTeX公式（如 $E=mc^2$ 或 $$\sum_{i=1}^n x_i$$）..."></div>
            </div>
            
            <div class="flex justify-end gap-4">
              <button type="button" id="cancelEditBtn" class="px-6 py-3 bg-white border border-neutral-300 text-neutral-700 rounded-full font-medium hover:bg-neutral-100 transition-colors">
                取消
              </button>
              <button type="button" id="previewBtn" class="px-6 py-3 bg-white border border-neutral-300 text-neutral-700 rounded-full font-medium hover:bg-neutral-100 transition-colors">
                预览
              </button>
              <button type="submit" class="px-6 py-3 bg-orange hover:bg-orange-dark text-white rounded-full font-medium transition-colors">
                <span id="submitBtnText">发布文章</span> <i class="fa fa-paper-plane ml-1" aria-hidden="true"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- 文章管理页面 -->
      <div id="managePage" class="page-content hidden py-12">
        <div class="container mx-auto px-4 max-w-5xl">
          <div class="flex items-center mb-8">
            <a href="#" class="text-neutral-600 hover:text-orange mr-4 transition-colors" data-page="home">
              <i class="fa fa-arrow-left" aria-hidden="true"></i> 返回首页
            </a>
            <h2 class="text-2xl font-bold">管理文章</h2>
          </div>
          
          <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
            <!-- 管理工具栏 -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 pb-4 border-b border-neutral-200">
              <div class="flex items-center gap-2">
                <button id="addNewArticleBtn" class="px-4 py-2 bg-orange hover:bg-orange-dark text-white rounded-lg font-medium transition-colors flex items-center gap-1">
                  <i class="fa fa-plus" aria-hidden="true"></i> 新建文章
                </button>
                <button id="batchDeleteBtn" class="px-4 py-2 bg-white border border-red-200 text-red-500 hover:bg-red-50 rounded-lg font-medium transition-colors flex items-center gap-1 hidden">
                  <i class="fa fa-trash" aria-hidden="true"></i> 批量删除
                </button>
              </div>
              
              <div class="flex flex-wrap gap-3 w-full md:w-auto">
                <div class="relative">
                  <input type="text" id="manageSearchInput" placeholder="搜索文章..." class="w-full md:w-64 px-4 py-2 pl-10 rounded-lg border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-orange focus:border-transparent">
                  <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400" aria-hidden="true"></i>
                </div>
                
                <div class="flex items-center gap-2">
                  <label class="text-neutral-600 whitespace-nowrap">排序：</label>
                  <div class="flex flex-wrap gap-1">
                    <button class="sort-btn px-3 py-1 rounded bg-white border border-neutral-300 hover:border-orange text-sm transition-colors" data-sort="newest">
                      最新 <i class="fa fa-chevron-down sort-icon ml-1 text-xs" aria-hidden="true"></i>
                    </button>
                    <button class="sort-btn px-3 py-1 rounded bg-white border border-neutral-300 hover:border-orange text-sm transition-colors" data-sort="oldest">
                      最早 <i class="fa fa-chevron-down sort-icon ml-1 text-xs" aria-hidden="true"></i>
                    </button>
                    <button class="sort-btn px-3 py-1 rounded bg-white border border-neutral-300 hover:border-orange text-sm transition-colors" data-sort="title-asc">
                      标题A-Z <i class="fa fa-chevron-down sort-icon ml-1 text-xs" aria-hidden="true"></i>
                    </button>
                    <button class="sort-btn px-3 py-1 rounded bg-white border border-neutral-300 hover:border-orange text-sm transition-colors" data-sort="title-desc">
                      标题Z-A <i class="fa fa-chevron-down sort-icon ml-1 text-xs" aria-hidden="true"></i>
                    </button>
                    <button class="sort-btn px-3 py-1 rounded bg-white border border-neutral-300 hover:border-orange text-sm transition-colors" data-sort="category">
                      分类 <i class="fa fa-chevron-down sort-icon ml-1 text-xs" aria-hidden="true"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 文章管理表格 -->
            <div class="overflow-x-auto">
              <table class="w-full manage-table">
                <thead>
                  <tr class="border-b-2 border-neutral-200">
                    <th class="text-left py-3 px-4 w-12">
                      <input type="checkbox" id="selectAllCheckbox" class="rounded text-orange focus:ring-orange">
                    </th>
                    <th class="text-left py-3 px-4">标题</th>
                    <th class="text-left py-3 px-4 hidden md:table-cell">分类</th>
                    <th class="text-left py-3 px-4 hidden sm:table-cell">发布日期</th>
                    <th class="text-left py-3 px-4 hidden lg:table-cell">阅读时间</th>
                    <th class="text-right py-3 px-4">操作</th>
                  </tr>
                </thead>
                <tbody id="manageArticlesTable">
                  <!-- 管理文章将通过JavaScript动态加载 -->
                  <tr id="noArticlesManage" class="text-center">
                    <td colspan="6" class="py-12 text-neutral-500">
                      <i class="fa fa-file-text-o text-4xl mb-2" aria-hidden="true"></i>
                      <p>没有文章可管理</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <!-- 分页 -->
            <div class="flex justify-between items-center mt-6 pt-4 border-t border-neutral-200">
              <div class="text-neutral-600 text-sm">
                显示 <span id="showingCount">0</span> 篇文章，共 <span id="totalCount">0</span> 篇
              </div>
              <div class="flex gap-2">
                <button id="prevPageBtn" class="px-3 py-1 rounded border border-neutral-300 text-neutral-600 hover:border-orange hover:text-orange disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                  <i class="fa fa-chevron-left" aria-hidden="true"></i> 上一页
                </button>
                <button id="nextPageBtn" class="px-3 py-1 rounded border border-neutral-300 text-neutral-600 hover:border-orange hover:text-orange disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                  下一页 <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 文章预览模态框 -->
      <div id="previewModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden fade-in">
        <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto m-4">
          <div class="p-6 border-b border-neutral-200 flex justify-between items-center">
            <h3 class="text-xl font-bold">文章预览</h3>
            <button id="closePreviewBtn" class="text-neutral-500 hover:text-neutral-800 transition-colors">
              <i class="fa fa-times text-xl" aria-hidden="true"></i>
            </button>
          </div>
          <div id="previewContent" class="p-6">
            <!-- 预览内容将通过JavaScript动态生成 -->
          </div>
        </div>
      </div>
      
      <!-- 删除确认模态框 -->
      <div id="deleteConfirmModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden fade-in">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full m-4 scale-in">
          <div class="p-6 border-b border-neutral-200">
            <h3 class="text-xl font-bold text-red-500">确认删除</h3>
          </div>
          <div class="p-6">
            <p class="mb-6">你确定要删除这篇文章吗？此操作无法撤销。</p>
            <div class="flex justify-end gap-3">
              <button id="cancelDeleteBtn" class="px-4 py-2 border border-neutral-300 rounded-lg text-neutral-700 hover:bg-neutral-100 transition-colors">
                取消
              </button>
              <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                确认删除
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 分类页面 -->
      <div id="categoriesPage" class="page-content hidden py-12">
        <div class="container mx-auto px-4">
          <div class="flex items-center mb-8">
            <a href="#" class="text-neutral-600 hover:text-orange mr-4 transition-colors" data-page="home">
              <i class="fa fa-arrow-left" aria-hidden="true"></i> 返回首页
            </a>
            <h2 class="text-2xl font-bold">文章分类</h2>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-xl shadow-md p-6 text-center card-hover">
              <div class="w-16 h-16 bg-orange-light rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa fa-code text-2xl text-orange" aria-hidden="true"></i>
              </div>
              <h3 class="text-xl font-bold mb-2">技术</h3>
              <p class="text-neutral-600 mb-4">妄想有哪天会用上的乱七八糟知识</p>
              <p class="text-orange font-medium"><span id="techCount">0</span> 篇文章</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 text-center card-hover">
              <div class="w-16 h-16 bg-orange-light rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa fa-coffee text-2xl text-orange" aria-hidden="true"></i>
              </div>
              <h3 class="text-xl font-bold mb-2">生活</h3>
              <p class="text-neutral-600 mb-4">平凡日常（平如凡）</p>
              <p class="text-orange font-medium"><span id="lifeCount">0</span> 篇文章</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 text-center card-hover">
              <div class="w-16 h-16 bg-orange-light rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa fa-lightbulb-o text-2xl text-orange" aria-hidden="true"></i>
              </div>
              <h3 class="text-xl font-bold mb-2">思考</h3>
              <p class="text-neutral-600 mb-4">闲话</p>
              <p class="text-orange font-medium"><span id="thoughtCount">0</span> 篇文章</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 关于页面 -->
      <div id="aboutPage" class="page-content hidden py-12">
        <div class="container mx-auto px-4 max-w-3xl">
          <div class="flex items-center mb-8">
            <a href="#" class="text-neutral-600 hover:text-orange mr-4 transition-colors" data-page="home">
              <i class="fa fa-arrow-left" aria-hidden="true"></i> 返回首页
            </a>
            <h2 class="text-2xl font-bold">关于我</h2>
          </div>
          
          <div class="bg-white rounded-xl shadow-md p-8">
            <div class="flex flex-col md:flex-row gap-8">
              <div class="md:w-1/3">
                <div class="rounded-full overflow-hidden w-40 h-40 mx-auto md:mx-0 border-4 border-orange-light">
                  <img src="https://catigeru.github.io/b_4e81e168d13d5442941bc08108585963.jpg" alt="博主头像" class="w-full h-full object-cover">
                </div>
              </div>
              <div class="md:w-2/3">
                <h3 class="text-2xl font-bold mb-4">大柯</h3>
                <p class="text-neutral-600 mb-4">
                  啥都想学啥都学不会的小笨蛋一个喵。
                </p>
                <p class="text-neutral-600 mb-4">
                  请输入文本。。
                </p>
                <div class="flex gap-4 mt-6">
                  <a href="#" class="text-neutral-600 hover:text-orange transition-colors text-xl">
                    <i class="fa fa-github" aria-hidden="true"></i>
                  </a>
                  <a href="#" class="text-neutral-600 hover:text-orange transition-colors text-xl">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                  </a>
                  <a href="#" class="text-neutral-600 hover:text-orange transition-colors text-xl">
                    <i class="fa fa-linkedin" aria-hidden="true"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-neutral-800 text-white py-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
        <div>
          <h3 class="text-xl font-bold mb-4 text-orange">大柯のblog</h3>
          <p class="text-neutral-400 mb-4">关注大柯喵，关注大柯谢谢喵。</p>
          <div class="flex gap-4">
            <a href="#" class="text-neutral-400 hover:text-orange transition-colors text-lg">
              <i class="fa fa-github" aria-hidden="true"></i>
            </a>
            <a href="#" class="text-neutral-400 hover:text-orange transition-colors text-lg">
              <i class="fa fa-twitter" aria-hidden="true"></i>
            </a>
            <a href="#" class="text-neutral-400 hover:text-orange transition-colors text-lg">
              <i class="fa fa-linkedin" aria-hidden="true"></i>
            </a>
            <a href="#" class="text-neutral-400 hover:text-orange transition-colors text-lg">
              <i class="fa fa-instagram" aria-hidden="true"></i>
            </a>
          </div>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold mb-4">快速链接</h4>
          <ul class="space-y-2">
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors" data-page="home">首页</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors" data-page="categories">所有文章</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors" data-page="manage">管理文章</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors" data-page="about">关于我</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors" data-page="write">写文章</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold mb-4">分类</h4>
          <ul class="space-y-2">
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors">技术</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors">生活</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors">思考</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors">旅行</a></li>
            <li><a href="#" class="text-neutral-400 hover:text-orange transition-colors">阅读</a></li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-neutral-700 pt-8 text-center text-neutral-500 text-sm">
        <p>&copy; 2025 大柯的blog. 保留所有权利。支持Markdown和LaTeX语法</p>
      </div>
    </div>
  </footer>

  <!-- 返回顶部按钮 -->
  <button id="backToTop" class="fixed bottom-6 right-6 bg-orange hover:bg-orange-dark text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 opacity-0 invisible">
    <i class="fa fa-arrow-up" aria-hidden="true"></i>
  </button>

  <!-- 通知提示 -->
  <div id="notification" class="fixed top-6 right-6 bg-white shadow-lg rounded-lg p-4 max-w-xs transform translate-x-full transition-transform duration-300 z-50 flex items-start gap-3">
    <div id="notificationIcon" class="text-green-500 mt-0.5">
      <i class="fa fa-check-circle text-xl" aria-hidden="true"></i>
    </div>
    <div>
      <h4 id="notificationTitle" class="font-semibold text-neutral-800">成功</h4>
      <p id="notificationMessage" class="text-neutral-600 text-sm">操作已完成</p>
    </div>
    <button id="closeNotification" class="text-neutral-400 hover:text-neutral-600 ml-auto">
      <i class="fa fa-times" aria-hidden="true"></i>
    </button>
  </div>

  <!-- JavaScript -->
  <script>
    // 全局变量
    let currentSort = 'newest';
    let currentPage = 1;
    const articlesPerPage = 10;
    let selectedArticleIds = [];
    let articleToDelete = null;
    let articles = []; // 存储从JSON加载的文章
    
    // GitHub 配置
    const GITHUB_USER = 'catigeru';
    const GITHUB_REPO = 'catigeru.github.io';
    const JSON_FILE_PATH = 'passage.json';
    
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
      // 从JSON文件加载文章
      loadArticlesFromJson();
      // 初始化事件监听
      initEventListeners();
      // 设置默认排序
      document.querySelector(`.sort-btn[data-sort="${currentSort}"]`).classList.add('active');
    });
    
    // 从JSON文件加载文章
    function loadArticlesFromJson() {
      // 显示加载状态
      showNotification('加载中', '正在获取文章数据...', false);
      
      // 显式指定UTF-8编码读取
      fetch(`https://${GITHUB_USER}.github.io/${JSON_FILE_PATH}`, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Accept-Charset': 'utf-8' // 强制使用UTF-8编码
        },
        cache: 'no-store' // 禁用缓存，确保获取最新内容
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP错误，状态码: ${response.status}`);
        }
        // 先以文本形式获取，确保UTF-8解码
        return response.text().then(text => {
          try {
            return JSON.parse(text);
          } catch (e) {
            console.error('JSON解析错误:', e);
            showNotification('错误', '文章数据格式错误', true);
            return [];
          }
        });
      })
      .then(data => {
        articles = data || [];
        // 加载文章到首页
        loadArticles();
        // 加载文章到管理页面
        loadManageArticles();
        // 更新分类统计
        updateCategoryCounts();
        // 隐藏加载通知
        hideNotification();
      })
      .catch(error => {
        console.error('加载文章失败:', error);
        showNotification('错误', '加载文章失败，请稍后重试', true);
      });
    }
    
    // 保存文章到GitHub（使用GitHub API）
    function saveArticleToGitHub(article) {
      // 检查是否有令牌
      const token = localStorage.getItem('githubToken');
      if (!token) {
        showNotification('认证失败', '请先输入GitHub访问令牌', true);
        return Promise.reject(new Error('未认证'));
      }
      
      // 准备文章数据
      let updatedArticles = [...articles];
      
      if (article.id) {
        // 更新现有文章
        const index = updatedArticles.findIndex(a => a.id === article.id);
        if (index !== -1) {
          updatedArticles[index] = article;
        }
      } else {
        // 添加新文章
        article.id = Date.now(); // 使用时间戳作为唯一ID
        article.date = new Date().toISOString().split('T')[0]; // 格式化为YYYY-MM-DD
        // 估算阅读时间（假设每分钟阅读200字，排除Markdown语法标记）
        const pureText = article.content.replace(/[#*`~$\[\](){}<>!-]/g, '').replace(/https?:\/\/\S+/g, '');
        const wordCount = pureText.length;
        article.readTime = Math.ceil(wordCount / 200);
        if (article.readTime < 1) article.readTime = 1;
        
        updatedArticles.unshift(article); // 添加到数组开头
      }
      
      // 获取文件的SHA（用于GitHub API更新）
      return fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${JSON_FILE_PATH}`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      })
      .then(response => response.json())
      .then(data => {
        // 准备更新数据
        const content = JSON.stringify(updatedArticles, null, 2); // 格式化JSON，保留缩进
        const base64Content = btoa(unescape(encodeURIComponent(content))); // 确保UTF-8编码的Base64转换
        
        // 调用GitHub API更新文件
        return fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${JSON_FILE_PATH}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: article.id ? `更新文章: ${article.title}` : `新增文章: ${article.title}`,
            content: base64Content,
            sha: data.sha
          })
        });
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`更新失败，状态码: ${response.status}`);
        }
        // 更新本地缓存
        articles = updatedArticles;
        return article;
      });
    }
    
    // 加载文章到首页（支持Markdown+LaTeX渲染）
    function loadArticles(category = 'all') {
      const articlesGrid = document.getElementById('articlesGrid');
      const noArticles = document.getElementById('noArticles');
      
      // 清空现有内容
      Array.from(articlesGrid.children).forEach(child => {
        if (child.id !== 'noArticles') {
          articlesGrid.removeChild(child);
        }
      });
      
      // 过滤文章
      let filteredArticles = articles;
      if (category !== 'all') {
        filteredArticles = articles.filter(article => article.category === category);
      }
      
      if (filteredArticles.length === 0) {
        // 没有文章时显示提示
        noArticles.classList.remove('hidden');
        return;
      }
      
      // 隐藏无文章提示
      noArticles.classList.add('hidden');
      
      // 显示文章
      filteredArticles.forEach((article, index) => {
        // 添加延迟动画效果
        setTimeout(() => {
          const articleCard = createArticleCard(article);
          articleCard.classList.add('fade-in', 'slide-up');
          articlesGrid.appendChild(articleCard);
          
          // 渲染卡片中的LaTeX公式
          renderMathInElement(articleCard, {
            delimiters: [
              { left: '$$', right: '$$', display: true },
              { left: '$', right: '$', display: false },
              { left: '\\(', right: '\\)', display: false },
              { left: '\\[', right: '\\]', display: true }
            ],
            throwOnError: false
          });
        }, index * 100);
      });
    }
    
    // 创建文章卡片（支持Markdown预览）
    function createArticleCard(article) {
      const card = document.createElement('article');
      card.className = 'bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl card-hover';
      
      // 默认封面图
      const defaultCover = `https://picsum.photos/600/400?random=${article.id % 10}`;
      
      // Markdown转为预览文本（截取前150字，排除HTML标签）
      marked.setOptions({ sanitize: true, breaks: true });
      const htmlPreview = marked.parse(article.content || '').replace(/<[^>]*>/g, '');
      const textPreview = htmlPreview.length > 150 
        ? htmlPreview.substring(0, 150) + '...' 
        : htmlPreview;
      
      card.innerHTML = `
        <div class="h-48 overflow-hidden">
          <img src="${article.cover || defaultCover}" alt="${article.title}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110 opacity-0 transition-opacity duration-500">
        </div>
        <div class="p-6">
          <div class="flex items-center gap-2 text-sm text-neutral-600 mb-3 flex-wrap">
            <span class="bg-orange-light text-orange px-2 py-1 rounded-full">${article.category}</span>
            <span><i class="fa fa-calendar-o mr-1" aria-hidden="true"></i> ${article.date}</span>
            <span><i class="fa fa-clock-o mr-1" aria-hidden="true"></i> ${article.readTime}分钟阅读</span>
          </div>
          <h3 class="text-xl font-bold mb-3 hover:text-orange transition-colors">
            <a href="#">${article.title}</a>
          </h3>
          <p class="text-neutral-600 mb-4 line-clamp-3 markdown-render">
            ${textPreview}
          </p>
          <div class="flex justify-between items-center">
            <a href="#" class="inline-flex items-center text-orange font-medium hover:underline">
              阅读全文 <i class="fa fa-long-arrow-right ml-2" aria-hidden="true"></i>
            </a>
            <div class="flex gap-2">
              <button class="text-neutral-400 hover:text-orange transition-colors edit-article" data-id="${article.id}" title="编辑">
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </button>
              <button class="text-neutral-400 hover:text-red-500 transition-colors delete-article" data-id="${article.id}" title="删除">
                <i class="fa fa-trash" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>
      `;
      
      // 图片加载完成后显示
      const img = card.querySelector('img');
      img.onload = () => {
        img.classList.add('opacity-100');
      };
      if (img.complete) {
        img.classList.add('opacity-100');
      }
      
      return card;
    }
    
    // 加载文章到管理页面
    function loadManageArticles(searchQuery = '') {
      let filteredArticles = [...articles];
      const tableBody = document.getElementById('manageArticlesTable');
      const noArticlesManage = document.getElementById('noArticlesManage');
      
      // 清空现有内容
      Array.from(tableBody.children).forEach(child => {
        if (child.id !== 'noArticlesManage') {
          tableBody.removeChild(child);
        }
      });
      
      // 搜索过滤
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filteredArticles = filteredArticles.filter(article => 
          article.title.toLowerCase().includes(query) || 
          article.category.toLowerCase().includes(query) ||
          article.content.replace(/[#*`~$\[\](){}]/g, '').toLowerCase().includes(query)
        );
      }
      
      // 排序
      filteredArticles = sortArticles(filteredArticles, currentSort);
      
      // 分页处理
      const totalArticles = filteredArticles.length;
      const totalPages = Math.ceil(totalArticles / articlesPerPage);
      const startIndex = (currentPage - 1) * articlesPerPage;
      const endIndex = startIndex + articlesPerPage;
      const paginatedArticles = filteredArticles.slice(startIndex, endIndex);
      
      // 更新分页信息
      document.getElementById('showingCount').textContent = paginatedArticles.length;
      document.getElementById('totalCount').textContent = totalArticles;
      
      // 更新分页按钮状态
      document.getElementById('prevPageBtn').disabled = currentPage === 1;
      document.getElementById('nextPageBtn').disabled = currentPage === totalPages || totalPages === 0;
      
      if (totalArticles === 0) {
        // 没有文章时显示提示
        noArticlesManage.classList.remove('hidden');
        document.getElementById('batchDeleteBtn').classList.add('hidden');
        return;
      }
      
      // 隐藏无文章提示
      noArticlesManage.classList.add('hidden');
      
      // 显示批量删除按钮（如果有文章）
      document.getElementById('batchDeleteBtn').classList.remove('hidden');
      
      // 显示文章
      paginatedArticles.forEach(article => {
        const row = document.createElement('tr');
        row.className = 'border-b border-neutral-200';
        row.innerHTML = `
          <td class="py-3 px-4">
            <input type="checkbox" class="article-checkbox rounded text-orange focus:ring-orange" data-id="${article.id}">
          </td>
          <td class="py-3 px-4">
            <div class="font-medium hover:text-orange transition-colors">${article.title}</div>
          </td>
          <td class="py-3 px-4 hidden md:table-cell">
            <span class="bg-orange-light text-orange px-2 py-1 rounded-full text-sm">${article.category}</span>
          </td>
          <td class="py-3 px-4 hidden sm:table-cell text-neutral-600">${article.date}</td>
          <td class="py-3 px-4 hidden lg:table-cell text-neutral-600">${article.readTime} 分钟</td>
          <td class="py-3 px-4 text-right">
            <div class="flex justify-end gap-2">
              <button class="text-neutral-600 hover:text-orange transition-colors edit-article" data-id="${article.id}" title="编辑">
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </button>
              <button class="text-neutral-600 hover:text-red-500 transition-colors delete-article" data-id="${article.id}" title="删除">
                <i class="fa fa-trash" aria-hidden="true"></i>
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      // 重置选中状态
      selectedArticleIds = [];
      document.getElementById('selectAllCheckbox').checked = false;
    }
    
    // 排序文章
    function sortArticles(articles, sortType) {
      switch (sortType) {
        case 'newest':
          return articles.sort((a, b) => new Date(b.date) - new Date(a.date));
        case 'oldest':
          return articles.sort((a, b) => new Date(a.date) - new Date(b.date));
        case 'title-asc':
          return articles.sort((a, b) => a.title.localeCompare(b.title));
        case 'title-desc':
          return articles.sort((a, b) => b.title.localeCompare(a.title));
        case 'category':
          return articles.sort((a, b) => a.category.localeCompare(b.category));
        default:
          return articles;
      }
    }
    
    // 更新分类统计
    function updateCategoryCounts() {
      const counts = {
        '技术': 0,
        '生活': 0,
        '思考': 0,
        '旅行': 0,
        '阅读': 0
      };
      
      articles.forEach(article => {
        if (counts.hasOwnProperty(article.category)) {
          counts[article.category]++;
        }
      });
      
      document.getElementById('techCount').textContent = counts['技术'];
      document.getElementById('lifeCount').textContent = counts['生活'];
      document.getElementById('thoughtCount').textContent = counts['思考'];
    }
    
    // 显示通知
    function showNotification(title, message, isError = false) {
      const notification = document.getElementById('notification');
      const notificationTitle = document.getElementById('notificationTitle');
      const notificationMessage = document.getElementById('notificationMessage');
      const notificationIcon = document.getElementById('notificationIcon');
      
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      
      // 设置图标和颜色
      if (isError) {
        notificationIcon.className = 'text-red-500 mt-0.5';
        notificationIcon.innerHTML = '<i class="fa fa-exclamation-circle text-xl" aria-hidden="true"></i>';
      } else {
        notificationIcon.className = 'text-green-500 mt-0.5';
        notificationIcon.innerHTML = '<i class="fa fa-check-circle text-xl" aria-hidden="true"></i>';
      }
      
      // 显示通知
      notification.classList.remove('translate-x-full');
      
      // 3秒后自动隐藏
      setTimeout(hideNotification, 3000);
    }
    
    // 隐藏通知
    function hideNotification() {
      const notification = document.getElementById('notification');
      notification.classList.add('translate-x-full');
    }
    
    // 删除文章
    function deleteArticle(id) {
      const token = localStorage.getItem('githubToken');
      if (!token) {
        showNotification('认证失败', '请先输入GitHub访问令牌', true);
        return;
      }
      
      // 过滤掉要删除的文章
      const updatedArticles = articles.filter(a => a.id !== id);
      
      // 获取文件的SHA
      fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${JSON_FILE_PATH}`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      })
      .then(response => response.json())
      .then(data => {
        // 准备更新数据
        const content = JSON.stringify(updatedArticles, null, 2);
        const base64Content = btoa(unescape(encodeURIComponent(content))); // 确保UTF-8编码
        
        // 调用GitHub API更新文件
        return fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${JSON_FILE_PATH}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: '删除文章',
            content: base64Content,
            sha: data.sha
          })
        });
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`删除失败，状态码: ${response.status}`);
        }
        // 更新本地缓存
        articles = updatedArticles;
        // 重新加载文章列表
        loadArticles();
        loadManageArticles(document.getElementById('manageSearchInput').value);
        // 更新分类统计
        updateCategoryCounts();
        
        showNotification('成功', '文章已删除');
      })
      .catch(error => {
        console.error('删除文章失败:', error);
        showNotification('错误', '删除文章失败，请稍后重试', true);
      });
    }
    
    // 批量删除文章
    function batchDeleteArticles(ids) {
      if (ids.length === 0) return;
      
      const token = localStorage.getItem('githubToken');
      if (!token) {
        showNotification('认证失败', '请先输入GitHub访问令牌', true);
        return;
      }
      
      // 过滤掉要删除的文章
      const updatedArticles = articles.filter(a => !ids.includes(a.id));
      
      // 获取文件的SHA
      fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${JSON_FILE_PATH}`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      })
      .then(response => response.json())
      .then(data => {
        // 准备更新数据
        const content = JSON.stringify(updatedArticles, null, 2);
        const base64Content = btoa(unescape(encodeURIComponent(content))); // 确保UTF-8编码
        
        // 调用GitHub API更新文件
        return fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${JSON_FILE_PATH}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: `批量删除 ${ids.length} 篇文章`,
            content: base64Content,
            sha: data.sha
          })
        });
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`删除失败，状态码: ${response.status}`);
        }
        // 更新本地缓存
        articles = updatedArticles;
        // 重新加载文章列表
        loadArticles();
        loadManageArticles(document.getElementById('manageSearchInput').value);
        // 更新分类统计
        updateCategoryCounts();
        
        showNotification('成功', `已删除 ${ids.length} 篇文章`);
      })
      .catch(error => {
        console.error('批量删除文章失败:', error);
        showNotification('错误', '删除文章失败，请稍后重试', true);
      });
    }
    
    // 初始化事件监听
    function initEventListeners() {
      // 检查是否有GitHub令牌，没有则提示输入
      if (!localStorage.getItem('githubToken')) {
        const token = prompt('请输入你的GitHub个人访问令牌（需要repo权限）：');
        if (token) {
          localStorage.setItem('githubToken', token);
          showNotification('认证成功', '已保存GitHub访问令牌');
        } else {
          showNotification('提示', '没有令牌将无法保存文章修改', false);
        }
      }
      
      // 移动端菜单切换
      const menuBtn = document.getElementById('menuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      
      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        mobileMenu.classList.toggle('slide-down');
      });
      
      // 页面切换
      document.querySelectorAll('[data-page]').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const page = this.getAttribute('data-page');
          
          // 隐藏所有页面
          document.querySelectorAll('.page-content').forEach(pageEl => {
            pageEl.classList.add('hidden');
          });
          
          // 显示目标页面
          document.getElementById(`${page}Page`).classList.remove('hidden');
          
          // 关闭移动菜单
          mobileMenu.classList.add('hidden');
          
          // 如果切换到管理页面，重新加载文章
          if (page === 'manage') {
            currentPage = 1;
            loadManageArticles();
          }
          
          // 滚动到顶部
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      });
      
      // 返回顶部按钮
      const backToTopBtn = document.getElementById('backToTop');
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          backToTopBtn.classList.remove('opacity-0', 'invisible');
          backToTopBtn.classList.add('opacity-100', 'visible');
        } else {
          backToTopBtn.classList.remove('opacity-100', 'visible');
          backToTopBtn.classList.add('opacity-0', 'invisible');
        }
        
        // 导航栏滚动效果
        const header = document.querySelector('header');
        if (window.scrollY > 100) {
          header.classList.add('py-2');
          header.classList.remove('py-4');
        } else {
          header.classList.add('py-4');
          header.classList.remove('py-2');
        }
      });
      
      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
      
      // 文章表单提交（存储Markdown文本）
      const articleForm = document.getElementById('articleForm');
      
      articleForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 获取Markdown文本（保留原始格式）
        const editorContent = document.getElementById('articleContent');
        const markdownContent = editorContent.innerText
          .replace(/\n{3,}/g, '\n\n') // 最多保留2个连续换行（Markdown标准）
          .replace(/\t/g, '  '); // 制表符转为2个空格
        
        // 组装文章数据
        const article = {
          id: document.getElementById('articleId').value ? parseInt(document.getElementById('articleId').value) : null,
          title: document.getElementById('articleTitle').value,
          category: document.getElementById('articleCategory').value,
          cover: document.getElementById('articleCover').value,
          content: markdownContent, // 存储Markdown原始文本
          isMarkdown: true // 标记为Markdown格式
        };
        
        // 保存文章
        saveArticleToGitHub(article)
          .then(savedArticle => {
            // 重置表单
            articleForm.reset();
            document.getElementById('articleId').value = '';
            editorContent.innerText = '';
            document.getElementById('submitBtnText').textContent = '发布文章';
            
            // 显示成功通知
            showNotification('成功', savedArticle.id ? '文章已更新' : '文章已发布');
            
            // 切换到首页
            document.querySelector('[data-page="home"]').click();
          })
          .catch(error => {
            console.error('保存文章失败:', error);
            showNotification('错误', '保存文章失败，请稍后重试', true);
          });
      });
      
      // 取消编辑按钮
      document.getElementById('cancelEditBtn').addEventListener('click', () => {
        // 重置表单
        articleForm.reset();
        document.getElementById('articleId').value = '';
        document.getElementById('articleContent').innerText = '';
        document.getElementById('submitBtnText').textContent = '发布文章';
        
        // 切换到首页
        document.querySelector('[data-page="home"]').click();
      });
      
      // 新增文章按钮
      document.getElementById('addNewArticleBtn').addEventListener('click', () => {
        // 重置表单
        articleForm.reset();
        document.getElementById('articleId').value = '';
        document.getElementById('articleContent').innerText = '';
        document.getElementById('submitBtnText').textContent = '发布文章';
        
        // 切换到写文章页面
        document.querySelector('[data-page="write"]').click();
      });
      
      // 分类筛选
      document.querySelectorAll('.category-filter').forEach(btn => {
        btn.addEventListener('click', function() {
          // 更新按钮样式
          document.querySelectorAll('.category-filter').forEach(b => {
            b.classList.remove('bg-orange', 'text-white');
            b.classList.add('bg-white', 'border', 'border-neutral-300', 'hover:border-orange', 'hover:text-orange');
          });
          this.classList.remove('bg-white', 'border', 'border-neutral-300', 'hover:border-orange', 'hover:text-orange');
          this.classList.add('bg-orange', 'text-white');
          
          // 筛选文章
          const category = this.getAttribute('data-category');
          loadArticles(category);
        });
      });
      
      // 排序按钮
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          // 更新按钮样式
          document.querySelectorAll('.sort-btn').forEach(b => {
            b.classList.remove('active');
          });
          this.classList.add('active');
          
          // 排序文章
          currentSort = this.getAttribute('data-sort');
          currentPage = 1; // 重置到第一页
          loadManageArticles(document.getElementById('manageSearchInput').value);
        });
      });
      
      // 搜索文章
      const manageSearchInput = document.getElementById('manageSearchInput');
      manageSearchInput.addEventListener('input', function() {
        currentPage = 1; // 重置到第一页
        loadManageArticles(this.value);
      });
      
      // 分页按钮
      document.getElementById('prevPageBtn').addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          loadManageArticles(manageSearchInput.value);
        }
      });
      
      document.getElementById('nextPageBtn').addEventListener('click', () => {
        const totalPages = Math.ceil(articles.length / articlesPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          loadManageArticles(manageSearchInput.value);
        }
      });
      
      // 全选复选框
      document.getElementById('selectAllCheckbox').addEventListener('change', function() {
        const isChecked = this.checked;
        const checkboxes = document.querySelectorAll('.article-checkbox');
        
        checkboxes.forEach(checkbox => {
          checkbox.checked = isChecked;
        });
        
        // 更新选中的文章ID
        selectedArticleIds = isChecked 
          ? Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')))
          : [];
      });
      
      // 文章复选框
      document.addEventListener('change', function(e) {
        if (e.target.classList.contains('article-checkbox')) {
          const articleId = parseInt(e.target.getAttribute('data-id'));
          
          if (e.target.checked) {
            selectedArticleIds.push(articleId);
          } else {
            selectedArticleIds = selectedArticleIds.filter(id => id !== articleId);
          }
          
          // 更新全选框状态
          const checkboxes = document.querySelectorAll('.article-checkbox');
          const allChecked = Array.from(checkboxes).every(cb => cb.checked);
          document.getElementById('selectAllCheckbox').checked = allChecked;
        }
      });
      
      // 批量删除按钮
      document.getElementById('batchDeleteBtn').addEventListener('click', () => {
        if (selectedArticleIds.length === 0) {
          showNotification('提示', '请先选择要删除的文章', false);
          return;
        }
        
        // 显示确认对话框
        document.getElementById('deleteConfirmModal').classList.remove('hidden');
        articleToDelete = null; // 标记为批量删除
      });
      
      // 编辑文章按钮
      document.addEventListener('click', function(e) {
        if (e.target.closest('.edit-article')) {
          e.preventDefault();
          const articleId = parseInt(e.target.closest('.edit-article').getAttribute('data-id'));
          const article = articles.find(a => a.id === articleId);
          
          if (article) {
            // 填充表单
            document.getElementById('articleId').value = article.id;
            document.getElementById('articleTitle').value = article.title;
            document.getElementById('articleCategory').value = article.category;
            document.getElementById('articleCover').value = article.cover || '';
            document.getElementById('articleContent').innerText = article.content || '';
            document.getElementById('submitBtnText').textContent = '更新文章';
            
            // 切换到写文章页面
            document.querySelector('[data-page="write"]').click();
            
            // 滚动到页面顶部
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          }
        }
      });
      
      // 删除文章按钮
      document.addEventListener('click', function(e) {
        if (e.target.closest('.delete-article')) {
          e.preventDefault();
          articleToDelete = parseInt(e.target.closest('.delete-article').getAttribute('data-id'));
          
          // 显示确认对话框
          document.getElementById('deleteConfirmModal').classList.remove('hidden');
        }
      });
      
      // 取消删除
      document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
        document.getElementById('deleteConfirmModal').classList.add('hidden');
        articleToDelete = null;
      });
      
      // 确认删除
      document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
        document.getElementById('deleteConfirmModal').classList.add('hidden');
        
        if (articleToDelete !== null) {
          // 删除单篇文章
          deleteArticle(articleToDelete);
        } else if (selectedArticleIds.length > 0) {
          // 批量删除文章
          batchDeleteArticles(selectedArticleIds);
        }
        
        articleToDelete = null;
        selectedArticleIds = [];
      });
      
      // 关闭通知
      document.getElementById('closeNotification').addEventListener('click', hideNotification);
      
      // 预览按钮
      document.getElementById('previewBtn').addEventListener('click', () => {
        const title = document.getElementById('articleTitle').value;
        const category = document.getElementById('articleCategory').value;
        const content = document.getElementById('articleContent').innerText;
        
        // 渲染Markdown内容
        marked.setOptions({ sanitize: true, breaks: true });
        const htmlContent = marked.parse(content || '');
        
        // 填充预览内容
        const previewContent = document.getElementById('previewContent');
        previewContent.innerHTML = `
          <h1 class="text-2xl font-bold mb-4">${title || '无标题'}</h1>
          <div class="mb-6 text-neutral-600">
            ${category ? `<span class="bg-orange-light text-orange px-2 py-1 rounded-full text-sm">${category}</span>` : ''}
            <span class="ml-2"><i class="fa fa-clock-o mr-1" aria-hidden="true"></i> 预览模式</span>
          </div>
          <div class="markdown-render">${htmlContent}</div>
        `;
        
        // 渲染LaTeX公式
        renderMathInElement(previewContent, {
          delimiters: [
            { left: '$$', right: '$$', display: true },
            { left: '$', right: '$', display: false },
            { left: '\\(', right: '\\)', display: false },
            { left: '\\[', right: '\\]', display: true }
          ],
          throwOnError: false
        });
        
        // 显示预览模态框
        document.getElementById('previewModal').classList.remove('hidden');
      });
      
      // 关闭预览
      document.getElementById('closePreviewBtn').addEventListener('click', () => {
        document.getElementById('previewModal').classList.add('hidden');
      });
      
      // Markdown编辑器工具栏功能
      document.querySelectorAll('.editor-toolbar button').forEach(button => {
        button.addEventListener('click', function() {
          const action = this.getAttribute('data-action');
          const editor = document.getElementById('articleContent');
          
          // 获取光标位置和选中内容
          const selection = window.getSelection();
          const selectedText = selection.toString();
          
          // 保存当前光标位置以便插入后恢复
          const range = selection.getRangeAt(0);
          const temp = document.createElement('span');
          range.insertNode(temp);
          
          // 根据不同操作处理内容
          switch (action) {
            case 'h1':
              wrapSelection(editor, '# ', '', selectedText || '一级标题');
              break;
            case 'h2':
              wrapSelection(editor, '## ', '', selectedText || '二级标题');
              break;
            case 'bold':
              wrapSelection(editor, '**', '**', selectedText || '粗体文本');
              break;
            case 'italic':
              wrapSelection(editor, '*', '*', selectedText || '斜体文本');
              break;
            case 'strike':
              wrapSelection(editor, '~~', '~~', selectedText || '删除线文本');
              break;
            case 'ul':
              wrapSelection(editor, '- ', '', selectedText || '列表项');
              break;
            case 'ol':
              wrapSelection(editor, '1. ', '', selectedText || '列表项');
              break;
            case 'quote':
              wrapSelection(editor, '> ', '', selectedText || '引用内容');
              break;
            case 'code':
              wrapSelection(editor, '```\n', '\n```', selectedText || '代码块');
              break;
            case 'link':
              wrapSelection(editor, '[', '](url)', selectedText || '链接文本');
              break;
            case 'image':
              wrapSelection(editor, '![', '](url)', selectedText || '图片描述');
              break;
            case 'latex-inline':
              wrapSelection(editor, '$', '$', selectedText || 'E=mc^2');
              break;
            case 'latex-block':
              wrapSelection(editor, '$$\n', '\n$$', selectedText || '\\sum_{i=1}^n x_i');
              break;
            case 'clear':
              editor.innerText = '';
              break;
          }
          
          // 恢复光标位置
          const newRange = document.createRange();
          newRange.setStartAfter(temp);
          newRange.setEndAfter(temp);
          selection.removeAllRanges();
          selection.addRange(newRange);
          temp.remove();
          
          // 聚焦编辑器
          editor.focus();
        });
      });
      
      // 辅助函数：在选中的文本前后添加内容
      function wrapSelection(editor, prefix, suffix, defaultText) {
        const selection = window.getSelection();
        const range = selection.getRangeAt(0);
        
        if (selection.toString()) {
          // 替换选中的文本
          const newText = prefix + selection.toString() + suffix;
          range.deleteContents();
          range.insertNode(document.createTextNode(newText));
        } else {
          // 如果没有选中文本，插入默认文本
          range.insertNode(document.createTextNode(prefix + defaultText + suffix));
        }
      }
    }
  </script>
</body>
</html>
    
